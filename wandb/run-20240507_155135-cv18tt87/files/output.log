cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
cuda is not available. use cpu instead.
============================================================Run Summary============================================================
Dataset:
 dataset:TinyImageNet | num_classes:200 | partition:noniid-label-distribution | beta:0.3
Server Info:
 strategy:FedNH | num_clients:100 | num_rounds: 10 | participate_ratio:0.1 | drop_ratio:0.0
Clients Info:
 model:ResNetMod | num_epochs:5 | batch_size:64 | optimizer:SGD | inint lr:0.01 | lr scheduler:diminishing | momentum: 0.9 | weight decay: 1e-05
2024-05-07 15:51:54,012 | INFO | ============================================================Run Summary============================================================
Dataset:
 dataset:TinyImageNet | num_classes:200 | partition:noniid-label-distribution | beta:0.3
Server Info:
 strategy:FedNH | num_clients:100 | num_rounds: 10 | participate_ratio:0.1 | drop_ratio:0.0
Clients Info:
 model:ResNetMod | num_epochs:5 | batch_size:64 | optimizer:SGD | inint lr:0.01 | lr scheduler:diminishing | momentum: 0.9 | weight decay: 1e-05
 ResNetMod: size:45.085 MB | num params: 11.271 M
2024-05-07 15:51:54,012 | INFO |  ResNetMod: size:45.085 MB | num params: 11.271 M
FedUHServer: the following layers will not be updated: ['prototype']
Strategy Related Hyper-parameters:
 server side
  FedNH_smoothing _ 0.9
  FedNH_server_adv_prototype_agg _ False
 client side
  FedNH_return_embedding _ False
  FedNH_head_init _ orthogonal
  FedNH_client_adv_prototype_agg _ False
  FedNH_fix_scaling _ False
Round:1 - Active clients:[80 84 33 81 93 17 36 82 69 65]:
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\logging\__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\logging\__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\logging\__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\logging\__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\main.py", line 285, in <module>
    run(args)
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\main.py", line 164, in run
    server = ServerCstr(server_config, clients_dict, exclude=server_config['exclude'],
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\strategies\FedNH.py", line 126, in __init__
    super().__init__(server_config, clients_dict, exclude, **kwargs)
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\strategies\FedUH.py", line 177, in __init__
    logging.info("FedUHServer: the following layers will not be updated:", freeze_layers)
Message: 'FedUHServer: the following layers will not be updated:'
Arguments: (['prototype'],)
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\logging\__init__.py", line 1160, in emit
    msg = self.format(record)
          ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\logging\__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\logging\__init__.py", line 703, in format
    record.message = record.getMessage()
                     ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\logging\__init__.py", line 392, in getMessage
    msg = msg % self.args
          ~~~~^~~~~~~~~~~
TypeError: not all arguments converted during string formatting
Call stack:
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\main.py", line 285, in <module>
    run(args)
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\main.py", line 164, in run
    server = ServerCstr(server_config, clients_dict, exclude=server_config['exclude'],
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\strategies\FedNH.py", line 126, in __init__
    super().__init__(server_config, clients_dict, exclude, **kwargs)
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\strategies\FedUH.py", line 177, in __init__
    logging.info("FedUHServer: the following layers will not be updated:", freeze_layers)
Message: 'FedUHServer: the following layers will not be updated:'
Arguments: (['prototype'],)
Traceback (most recent call last):
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\main.py", line 285, in <module>
    run(args)
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\main.py", line 176, in run
    server.run(filename=path + '_best_global_model.pkl', use_wandb=use_wandb, global_seed=args.global_seed)
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\strategies\FedAvg.py", line 258, in run
    client_uploads.append(client.upload())
                          ^^^^^^^^^^^^^^^
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\strategies\FedNH.py", line 121, in upload
    return self.new_state_dict, self._estimate_prototype()
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\strategies\FedNH.py", line 40, in _estimate_prototype
    feature_embedding, _ = self.model.forward(x)
                           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\models\CNN.py", line 112, in forward
    feature_embedding = self.backbone(x)
                        ^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\models\ResNet.py", line 96, in forward
    out = self.layer1(out)
          ^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\container.py", line 217, in forward
    input = module(input)
            ^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\Documents\Comvis2023\Fed_Ha_Phuong\New folder\FedNH\src\flbase\models\ResNet.py", line 33, in forward
    out = F.relu(self.bn1(self.conv1(x)))
                          ^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\conv.py", line 460, in forward
    return self._conv_forward(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\admin\AppData\Local\Programs\Python\Python312\Lib\site-packages\torch\nn\modules\conv.py", line 456, in _conv_forward
    return F.conv2d(input, weight, bias, self.stride,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt